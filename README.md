# YANDEX-DIALOGS-PHP

PHP библиотека для разработки навыков Яндекс.Алисы
___

##  Содержание

 1. [История версий / TODO](#todo)
 2. [Примеры использования](#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B)
 3. [Описание свойств](#%D1%81%D0%B2%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0)
 	+ [request](#request)
	+ [response](#response)
 4. [Описание методов](#%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B)
 	+ [Конструктор](#%D0%BA%D0%BE%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D0%BE%D1%80)
	+ [get_request](#get_request)
	+ [bind_new_action](#bind_new_action)
	+ [bind_words_action](#bind_words_action)
	+ [bind_percentage_action](#bind_percentage_action)
	+ [bind_default_action](#bind_default_action)
	+ [add_button](#add_button)
	+ [add_message](#add_message)
	+ [end_session](#end_session)
	+ [finish](#finish)

___
## TODO
| Описание изменений | Дата публикации 
|--|:--:|
|Первая публичная версия | **08.01.2019**
|Отправка сообщений с изображениями | ---
|Сохранение данных сессии | ---
|Сохранение данных пользователя | ---
|Морфологический анализ слов | ---
|Подключение Яндекс.Метрика | ---
|Подключение AppMetrica | ---
|Подключение Google Chatbase | ---
|Подключение Google Analytics | ---
|Анализ текста с помощью Томита-парсер | ---

## Примеры
Примеры использования библиотеки находятся в папке [examples](/thesoultaker48/yandex-dialogs-php/tree/master/examples).

## Свойства
Не рекомендуется прямое изменение свойств объектов класса YandexDialog. Делайте это через соответствующие методы.

### request
Содержит информацию о запросе пользователя. Более подробно можно почитать в [официальной документации](https://tech.yandex.ru/dialogs/alice/doc/protocol-docpage/#request) к протоколу.

### response
Содержит данные ответа на запрос пользователя. Более подробно можно почитать в [официальной документации](https://tech.yandex.ru/dialogs/alice/doc/protocol-docpage/#response) к протоколу.

## Методы

### Конструктор
Создание объекта класса YandexDialog.

`$version` - Номер используемой версии протокола. Строка. Не обязательно. По умолчанию: '1.0'.

	$alice = new YandexDialog('1.0');

### get_request

Получить информацию о запросе пользователя.

`$data` - Данные запроса пользователя. Многомерный массив ([см.тут](https://tech.yandex.ru/dialogs/alice/doc/protocol-docpage/#request)). Не обязательно. По умолчанию: декодированный json из php://input.

	$alice->get_request();

### bind_new_action

Связывает указанную функцию с событием начала нового диалога (новой сессии). В вызываемую функцию передается указатель на $this.

`$action` - Имя функции, которой необходимо передавать управление. Строка. Обязательный параметр.

	function new_session_action($alice) {
		...
		some code
		...
	}
	$alice->bind_new_action('new_session_action');

### bind_words_action

Связывает указанную функцию с событием нахождения одного из заданных слов в запросе пользователя. В вызываемую функцию передается указатель на $this и обнаруженное слово.

`$words` - Слова для поиска (в нижнем регистре). Массив. Обязательный параметр;

`$action` - Имя функции, которой необходимо передавать управление. Строка. Обязательный параметр.

	function find_word_action($word, $alice) {
		...
		some code
		...
	}
	$alice->bind_words_action(array('яблоко', 'груша', 'апельсин'), 'find_word_action');

### bind_percentage_action

Связывает указанную функцию с событием превышения (или равенства) заданного процентного нахождения слов в запросе пользователя. В вызываемую функцию передается указатель на $this и найденное процентное значение.

`$words` - Слова для поиска (в нижнем регистре). Элементы так же могут быть массивами - в таком случае любое из совпадений внутри вложенного массива считается как совпадение всего массива. Массив. Обязательный параметр;

`$percentage` - Процентное значение, при достижении которого выполняется указанная функция. Число. Обязательный параметр;

`$action` - Имя функции, которой необходимо передавать управление. Строка. Обязательный параметр.

	function percentage_word_action($percent, $alice) {
		...
		some code
		...
	}
	$alice->bind_percentage_action(array(array('яблоко', 'груша'), 'апельсин'), 75, 'percentage_word_action');

### bind_default_action

Связывает указанную функцию с собитием отсутствия других действий. Отлично подходит для обработки ситуаций, когда фраза пользователя не распознана. В вызываемую функцию передается указатель на $this.

`$action` - Имя функции, которой необходимо передавать управление. Строка. Обязательный параметр.

	function default_action($alice) {
		...
		some code
		...
	}
	$alice->bind_default_action('default_action');

### add_button

Добавляет кнопку в варианты ответа пользователя.

`$title` - Текст кнопки, который будет отправлен навыку по ее нажатию;

`$url` - URL, который должна открывать кнопка;

`$payload` - Произвольные данные, которые Яндекс.Диалоги должны отправить обработчику, если данная кнопка будет нажата;

`$hide` - Признак того, что кнопку нужно убрать после следующей реплики пользователя.

	$alice->add_button('Открой Яндекс', 'http://yandex.ru');
	$alice->add_button('Сделать заказ', NULL, array('item' => 42, 'price' => 100), true);

### add_message

### end_session

### finish
